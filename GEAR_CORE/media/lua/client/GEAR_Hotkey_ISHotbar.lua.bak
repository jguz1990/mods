

require "ISUI/ISPanelJoypad"


local Original_HotbaronKeyPressed = ISHotbar.onKeyPressed

ISHotbar.onKeyPressed = function(key)
	local playerObj = getSpecificPlayer(0)
	if not playerObj or playerObj:isDead() then
		return
	end
	if UIManager.getSpeedControls() and (UIManager.getSpeedControls():getCurrentGameSpeed() == 0) then
		return
	end
	local radialMenu = getPlayerRadialMenu(0)
	if radialMenu:isReallyVisible() or getPlayerHotbar(0).radialWasVisible then
		if not getCore():getOptionRadialMenuKeyToggle() then
			radialMenu:removeFromUIManager()
		end
		return
	end
	if playerObj:isAttacking() then
		return;
	end
	local slotToCheck = -1;
	local self = getPlayerHotbar(0);
	
	-- don't do hotkey if you're doing action
	local queue = ISTimedActionQueue.queues[playerObj];
	if queue and #queue.queue > 0 then
		return;
	end

	if key == getCore():getKey("Hotbar 1") then slotToCheck = 1; end
	if key == getCore():getKey("Hotbar 2") then slotToCheck = 2; end
	if key == getCore():getKey("Hotbar 3") then slotToCheck = 3; end
	if key == getCore():getKey("Hotbar 4") then slotToCheck = 4; end
	if key == getCore():getKey("Hotbar 5") then slotToCheck = 5; end
	if key == getCore():getKey("Hotbar 6") then slotToCheck = 6; end
	if key == getCore():getKey("Hotbar 7") then slotToCheck = 7; end
	if key == getCore():getKey("Hotbar 8") then slotToCheck = 8; end
	if key == getCore():getKey("Hotbar 9") then slotToCheck = 9; end
	if key == getCore():getKey("Hotbar 0") then slotToCheck = 10; end
	if key == getCore():getKey("Hotbar 11") then slotToCheck = 11; end
	if key == getCore():getKey("Hotbar 12") then slotToCheck = 12; end
	if key == getCore():getKey("Hotbar 13") then slotToCheck = 13; end
	if key == getCore():getKey("Hotbar 14") then slotToCheck = 14; end
	if key == getCore():getKey("Hotbar 15") then slotToCheck = 15; end
	if slotToCheck ~= -1 then
		for i, item in pairs(self.attachedItems) do
			if item:getAttachedSlot() == slotToCheck then
				self:equipItem(item);
				return;
			end
		end
	end
	
	Original_HotbaronKeyPressed(self)
end


local Original_HotbaronKeyKeepPressed = ISHotbar.onKeyKeepPressed

ISHotbar.onKeyKeepPressed = function(key)
	local playerObj = getSpecificPlayer(0)
	if not playerObj or playerObj:isDead() then
		return
	end
	if UIManager.getSpeedControls() and (UIManager.getSpeedControls():getCurrentGameSpeed() == 0) then
		return
	end
	if playerObj:isAttacking() then
		return
	end
	local queue = ISTimedActionQueue.queues[playerObj]
	if queue and #queue.queue > 0 then
		return
	end
	if getPlayerHotbar(0).radialWasVisible then
		return
	end
	local slotToCheck = -1;
	if key == getCore():getKey("Hotbar 1") then slotToCheck = 1; end
	if key == getCore():getKey("Hotbar 2") then slotToCheck = 2; end
	if key == getCore():getKey("Hotbar 3") then slotToCheck = 3; end
	if key == getCore():getKey("Hotbar 4") then slotToCheck = 4; end
	if key == getCore():getKey("Hotbar 5") then slotToCheck = 5; end
	if key == getCore():getKey("Hotbar 6") then slotToCheck = 6; end
	if key == getCore():getKey("Hotbar 7") then slotToCheck = 7; end
	if key == getCore():getKey("Hotbar 8") then slotToCheck = 8; end
	if key == getCore():getKey("Hotbar 9") then slotToCheck = 9; end
	if key == getCore():getKey("Hotbar 0") then slotToCheck = 10; end
	if key == getCore():getKey("Hotbar 0") then slotToCheck = 10; end
	if key == getCore():getKey("Hotbar 11") then slotToCheck = 11; end
	if key == getCore():getKey("Hotbar 12") then slotToCheck = 12; end
	if key == getCore():getKey("Hotbar 13") then slotToCheck = 13; end
	if key == getCore():getKey("Hotbar 14") then slotToCheck = 14; end
	if key == getCore():getKey("Hotbar 15") then slotToCheck = 15; end
	if slotToCheck == -1 then
		return
	end
	
	Original_HotbaronKeyKeepPressed(self)
	
end

